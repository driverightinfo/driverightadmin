<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driving School Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .tab-button {
            padding: 15px 30px;
            border: none;
            cursor: pointer;
            transition: background-color 0.15s;
        }
        /* Custom modal styles */
        .modal {
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- Message Box Element (Replaces alert()) -->
    <div id="message-box" class="fixed top-4 right-4 z-50 transition-all duration-300 transform translate-x-full"></div>

    <div id="app" class="max-w-7xl mx-auto rounded-xl shadow-2xl overflow-hidden bg-white">
        
        <!-- Header: API Inputs -->
        <header class="bg-indigo-600 p-4 text-white">
            <h1 class="text-2xl font-bold mb-2">Driving School Manager</h1>
            
            <!-- Credentials Input Area -->
            <details class="bg-indigo-700 p-4 rounded-lg">
                <summary class="font-semibold cursor-pointer flex justify-between items-center">
                    Credentials & Configuration (Click to Edit)
                    <svg class="w-4 h-4 text-white ml-2 transform details-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </summary>
                <div class="mt-4 space-y-3">
                    <input id="sheetIdInput" placeholder="Google Sheet ID" type="text" 
                        class="w-full p-2 rounded-md text-gray-900 placeholder-gray-500 bg-indigo-50" />
                    <input id="apiKeyInput" placeholder="Google API Key (Read Only)" type="text" 
                        class="w-full p-2 rounded-md text-gray-900 placeholder-gray-500 bg-indigo-50" />
                    <input id="webAppUrlInput" placeholder="Apps Script Web App URL (For Writing)" type="text" 
                        class="w-full p-2 rounded-md text-gray-900 placeholder-gray-500 bg-indigo-50" />
                    <button onclick="saveCredentialsAndReload()" class="w-full bg-yellow-400 text-gray-800 px-3 py-2 rounded-md font-semibold hover:bg-yellow-300 transition-colors">
                        Save Credentials and Reload
                    </button>
                    <button onclick="loadData()" class="w-full bg-indigo-500 text-white px-3 py-2 rounded-md font-semibold hover:bg-indigo-400 transition-colors">
                        ðŸ”„ Reload Data
                    </button>
                </div>
            </details>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex border-b border-gray-200">
            <button id="dashboardTab" class="tab-button bg-white text-gray-600 border-b-2 border-transparent hover:bg-gray-50" onclick="setActiveTab('dashboard')">Dashboard</button>
            <button id="studentsTab" class="tab-button bg-white text-gray-600 border-b-2 border-transparent hover:bg-gray-50" onclick="setActiveTab('students')">Students</button>
            <button id="paymentsTab" class="tab-button bg-white text-gray-600 border-b-2 border-transparent hover:bg-gray-50" onclick="setActiveTab('payments')">Payments</button>
        </nav>

        <!-- Content Area -->
        <main id="content" class="p-4 md:p-8"></main>

    </div>

    <!-- Modal Container -->
    <div id="modal-container"></div>

    <script>
        // --- Configuration Storage and State ---
        const CREDENTIALS_KEY = 'drivingSchoolCredentials';
        
        function saveCredentialsAndReload() {
            const credentials = {
                SHEET_ID: document.getElementById('sheetIdInput').value.trim(),
                API_KEY: document.getElementById('apiKeyInput').value.trim(),
                WEB_APP_URL: document.getElementById('webAppUrlInput').value.trim()
            };
            localStorage.setItem(CREDENTIALS_KEY, JSON.stringify(credentials));
            showMessage('Credentials saved. Reloading data...', 'info');
            loadData();
        }

        function getApiCredentials() {
            const stored = localStorage.getItem(CREDENTIALS_KEY);
            const defaults = { 
                SHEET_ID: '', 
                API_KEY: '', 
                WEB_APP_URL: '' 
            };
            
            if (stored) {
                return JSON.parse(stored);
            }
            
            return defaults;
        }

        // Initialize input fields with stored values
        window.onload = () => {
            const creds = getApiCredentials();
            document.getElementById('sheetIdInput').value = creds.SHEET_ID;
            document.getElementById('apiKeyInput').value = creds.API_KEY;
            document.getElementById('webAppUrlInput').value = creds.WEB_APP_URL;
            loadData();
        };


        const appState = {
            activeTab: 'dashboard',
            students: [],
            payments: [],
            loading: false,
        };

        // --- Message/Alert Box Implementation (Replaces alert()) ---

        const msgBox = document.getElementById('message-box');
        function showMessage(message, type = 'info', extraContent = null) {
            const colors = {
                info: 'bg-blue-500',
                error: 'bg-red-500',
                success: 'bg-green-500'
            };

            const element = document.createElement('div');
            element.className = `${colors[type]} text-white p-4 rounded-lg shadow-lg mb-2 flex items-center justify-between`;
            
            const textNode = document.createElement('p');
            textNode.textContent = message;
            element.appendChild(textNode);

            if (extraContent) {
                const contentWrapper = document.createElement('div');
                contentWrapper.innerHTML = extraContent;
                element.appendChild(contentWrapper);
            }
            
            // Clear previous messages and add new one
            msgBox.innerHTML = '';
            msgBox.appendChild(element);

            // Animate in
            msgBox.classList.remove('translate-x-full');

            // Animate out after 8 seconds (or longer if it has a button)
            const duration = extraContent ? 15000 : 5000;
            setTimeout(() => {
                msgBox.classList.add('translate-x-full');
            }, duration);
        }

        // --- API Configuration and Data Fetching (READ-ONLY using API Key) ---

        async function loadData() {
            const { SHEET_ID, API_KEY } = getApiCredentials();

            if (!SHEET_ID || !API_KEY) {
                showMessage('Please enter the Sheet ID and API Key to load data.', 'info');
                appState.students = [];
                appState.payments = [];
                appState.loading = false;
                render();
                return;
            }

            appState.loading = true;
            render(); // Show loading state

            try {
                // 1. Load Students
                const studentsRes = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Students?key=${API_KEY}`);
                const studentsData = await studentsRes.json();
                
                if (studentsData.error) {
                    throw new Error(studentsData.error.message || "Failed to load Students data.");
                }

                if (studentsData.values && studentsData.values.length > 1) {
                    // Assuming structure: [ID, Name, Phone, Email, TotalFee]
                    appState.students = studentsData.values.slice(1).map(row => ({
                        id: row[0],
                        name: row[1],
                        phone: row[2],
                        email: row[3],
                        totalFee: parseFloat(row[4] || 0)
                    }));
                } else {
                    appState.students = [];
                }

                // 2. Load Payments
                const paymentsRes = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Payments?key=${API_KEY}`);
                const paymentsData = await paymentsRes.json();

                if (paymentsData.error) {
                     throw new Error(paymentsData.error.message || "Failed to load Payments data.");
                }
                
                if (paymentsData.values && paymentsData.values.length > 1) {
                    // Assuming structure: [ID, StudentID, Amount, Date, Method]
                    appState.payments = paymentsData.values.slice(1).map(row => ({
                        id: row[0],
                        studentId: row[1],
                        amount: parseFloat(row[2] || 0),
                        date: row[3],
                        method: row[4]
                    }));
                } else {
                    appState.payments = [];
                }

                showMessage('Data loaded successfully!', 'success');

            } catch (err) {
                console.error("Data Load Error:", err);
                showMessage(`Error loading data: ${err.message}. Check Sheet ID, API Key, and sheet sharing permissions.`, 'error');
            } finally {
                appState.loading = false;
                render();
            }
        }

        // --- WRITING FUNCTION (WRITE using Apps Script URL) ---
        async function addToSheet(sheetName, values) {
            const { WEB_APP_URL } = getApiCredentials();
            
            if (!WEB_APP_URL) {
                showMessage('The Web App URL is required to save data. Please enter it in the configuration.', 'error');
                return;
            }

            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({
                        action: 'add',
                        sheet: sheetName,
                        values: JSON.stringify(values)
                    })
                });

                const result = await response.json(); 

                if (result.status === 'success') {
                    let message = `${sheetName} record added successfully!`;
                    let extraContent = null;

                    if (sheetName === 'Payments' && result.receiptUrl) {
                        message = `Payment recorded. Receipt ready!`;
                        extraContent = `<a href="${result.receiptUrl}" target="_blank" class="ml-4 px-3 py-1 bg-yellow-400 text-gray-900 rounded-md font-bold hover:bg-yellow-300">Open Receipt PDF</a>`;
                    }
                    
                    showMessage(message, 'success', extraContent);
                    await loadData(); // Reload data to reflect changes
                    closeModal();
                } else {
                    // Show error returned from the Apps Script
                    throw new Error(result.message || 'Apps Script failed to append data.');
                }
                
            } catch (error) {
                console.error("Save Error:", error);
                showMessage(`Error saving data via Apps Script: ${error.message}`, 'error');
            }
        }

        // --- Form Submission Handlers ---

        function addStudent(event) {
            const form = event.target;
            const newId = crypto.randomUUID().substring(0, 8).toUpperCase(); // Simple 8-char ID
            const values = [
                newId,
                form.elements.name.value,
                form.elements.phone.value,
                form.elements.email.value,
                parseFloat(form.elements.totalFee.value).toFixed(2)
            ];
            addToSheet('Students', values);
        }

        function addPayment(event) {
            const form = event.target;
            const newId = `P-${Date.now()}`; // Payment ID based on timestamp
            
            // Note: studentId is the value from the select, which is the student's unique ID
            const values = [
                newId,
                form.elements.studentId.value,
                parseFloat(form.elements.amount.value).toFixed(2),
                form.elements.date.value,
                form.elements.method.value
            ];
            addToSheet('Payments', values);
        }

        // --- Utility Functions ---
        
        function getStudentName(id) {
            return appState.students.find(s => s.id == id)?.name || 'Unknown';
        }

        function getTotalPaid(id) {
            return appState.payments
                .filter(p => p.studentId == id)
                .reduce((sum, p) => sum + p.amount, 0);
        }

        function getStatus(id) {
            const student = appState.students.find(s => s.id == id);
            if (!student) return 'N/A';
            const paid = getTotalPaid(id);
            const fee = student.totalFee;

            if (fee <= 0) return 'NO FEE';
            if (paid >= fee) return 'PAID';
            if (paid > 0 && paid < fee) return 'PARTIAL';
            return 'UNPAID';
        }

        // --- Rendering Logic ---

        function setActiveTab(tab) {
            appState.activeTab = tab;
            render();
        }

        function renderDashboard() {
            const totalRevenue = appState.payments.reduce((sum, p) => sum + p.amount, 0);
            const totalStudents = appState.students.length;
            const unpaidStudents = appState.students.filter(s => getStatus(s.id) === 'UNPAID').length;

            return `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Card 1: Total Students -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500">
                        <div class="text-sm font-medium text-gray-500">Total Students</div>
                        <div class="mt-1 text-4xl font-extrabold text-indigo-600">${totalStudents}</div>
                    </div>

                    <!-- Card 2: Total Revenue -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-emerald-500">
                        <div class="text-sm font-medium text-gray-500">Total Revenue</div>
                        <div class="mt-1 text-4xl font-extrabold text-emerald-600">RM ${totalRevenue.toFixed(2)}</div>
                    </div>

                    <!-- Card 3: Unpaid Students -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500">
                        <div class="text-sm font-medium text-gray-500">Unpaid Students</div>
                        <div class="mt-1 text-4xl font-extrabold text-red-600">${unpaidStudents}</div>
                    </div>
                </div>
                <h2 class="text-xl font-bold mt-8 mb-4 text-gray-700">Recent Activity</h2>
                <div class="bg-white rounded-xl shadow-lg overflow-x-auto">
                    ${renderRecentPayments()}
                </div>
            `;
        }
        
        function renderRecentPayments() {
            const recentPayments = appState.payments
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            if (recentPayments.length === 0) {
                return '<p class="p-4 text-gray-500 text-center">No recent payments recorded.</p>';
            }

            return `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount (RM)</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Method</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        ${recentPayments.map(p => `
                            <tr class="hover:bg-emerald-50 transition duration-100">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${p.date}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${getStudentName(p.studentId)}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-emerald-600 font-bold">${p.amount.toFixed(2)}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${p.method}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderStudents() {
            return `
                <button onclick="openModal('student')" class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 mb-6">
                    + Enroll New Student
                </button>
                <div class="bg-white rounded-xl shadow-lg overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Fee (RM)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Paid (RM)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${appState.students.map(s => {
                                const totalPaid = getTotalPaid(s.id);
                                const status = getStatus(s.id);
                                let colors = '';
                                if (status === 'PAID') colors = 'bg-green-100 text-green-800';
                                else if (status === 'PARTIAL') colors = 'bg-yellow-100 text-yellow-800';
                                else if (status === 'NO FEE') colors = 'bg-blue-100 text-blue-800';
                                else colors = 'bg-red-100 text-red-800';

                                return `
                                    <tr class="hover:bg-indigo-50 transition duration-100">
                                        <td class="px-6 py-4 whitespace-nowrap text-xs text-gray-500">${s.id}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${s.name}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${s.totalFee.toFixed(2)}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-emerald-600 font-semibold">${totalPaid.toFixed(2)}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${colors}">
                                                ${status}
                                            </span>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                            ${appState.students.length === 0 ? '<tr><td colspan="5" class="text-center py-4 text-gray-500">No students enrolled yet.</td></tr>' : ''}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderPayments() {
             return `
                <button onclick="openModal('payment')" class="px-6 py-3 bg-emerald-600 text-white font-semibold rounded-lg shadow-md hover:bg-emerald-700 transition duration-150 mb-6">
                    + Record New Payment
                </button>
                <div class="bg-white rounded-xl shadow-lg overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount (RM)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Method</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${appState.payments.sort((a, b) => new Date(b.date) - new Date(a.date)).map(p => `
                                <tr class="hover:bg-emerald-50 transition duration-100">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${p.date}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${getStudentName(p.studentId)}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-emerald-600 font-bold">${p.amount.toFixed(2)}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${p.method}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-xs text-gray-500">${p.id}</td>
                                </tr>
                            `).join('')}
                            ${appState.payments.length === 0 ? '<tr><td colspan="5" class="text-center py-4 text-gray-500">No payments recorded yet.</td></tr>' : ''}
                        </tbody>
                    </table>
                </div>
            `;
        }


        function render() {
            const contentDiv = document.getElementById('content');
            const tabs = ['dashboard', 'students', 'payments'];

            // Update Tab Colors
            tabs.forEach(tab => {
                const tabButton = document.getElementById(`${tab}Tab`);
                if (tabButton) {
                    if (appState.activeTab === tab) {
                        tabButton.className = 'tab-button bg-indigo-50 text-indigo-700 border-b-2 border-indigo-600';
                    } else {
                        tabButton.className = 'tab-button bg-white text-gray-600 border-b-2 border-transparent hover:bg-gray-50';
                    }
                }
            });

            if (appState.loading) {
                contentDiv.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
                        <p class="mt-4 text-gray-600">Loading data from Google Sheets...</p>
                    </div>
                `;
                return;
            }

            // Render Content based on active tab
            switch (appState.activeTab) {
                case 'dashboard':
                    contentDiv.innerHTML = renderDashboard();
                    break;
                case 'students':
                    contentDiv.innerHTML = renderStudents();
                    break;
                case 'payments':
                    contentDiv.innerHTML = renderPayments();
                    break;
                default:
                    contentDiv.innerHTML = renderDashboard();
            }
        }

        // --- Modal Logic and Forms ---

        function openModal(type) {
            const container = document.getElementById('modal-container');
            let content;
            let title;
            let submitFunction;
            
            if (type === 'student') {
                title = 'Enroll New Student';
                submitFunction = addStudent;
                content = `
                    <form onsubmit="event.preventDefault(); ${submitFunction.name}(event);" class="space-y-4">
                        <input name="name" placeholder="Full Name" required type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" />
                        <input name="phone" placeholder="Phone Number" required type="tel" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" />
                        <input name="email" placeholder="Email Address" required type="email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" />
                        <input name="totalFee" placeholder="Total Course Fee (RM)" required type="number" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" />
                        <button type="submit" class="w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md">
                            Enroll Student
                        </button>
                    </form>
                `;
            } else if (type === 'payment') {
                title = 'Record New Payment';
                submitFunction = addPayment;
                const studentOptions = appState.students.map(s => {
                    const paid = getTotalPaid(s.id);
                    return `<option value="${s.id}">${s.name} (Paid: RM ${paid.toFixed(2)} / Fee: RM ${s.totalFee.toFixed(2)})</option>`;
                }).join('');

                content = `
                    <form onsubmit="event.preventDefault(); ${submitFunction.name}(event);" class="space-y-4">
                        <select name="studentId" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500 transition duration-150">
                            <option value="">Select Student (Required)</option>
                            ${studentOptions}
                        </select>
                        <input name="amount" placeholder="Amount Paid (RM)" required type="number" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500 transition duration-150" />
                        <input name="date" type="date" required value="${new Date().toISOString().split('T')[0]}" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500 transition duration-150" />
                        <select name="method" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500 transition duration-150">
                            <option>Cash</option>
                            <option>Bank Transfer</option>
                            <option>Credit Card</option>
                            <option>E-Wallet</option>
                        </select>
                        <button type="submit" class="w-full py-3 bg-emerald-600 text-white font-semibold rounded-lg hover:bg-emerald-700 transition duration-150 shadow-md">
                            Record Payment
                        </button>
                    </form>
                `;
            }

            container.innerHTML = `
                <div id="app-modal" class="modal active fixed inset-0 z-40" role="dialog" aria-modal="true" onclick="if (event.target.id === 'app-modal') closeModal()">
                    <div class="relative bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg transition-all transform duration-300 scale-95 opacity-0 active:scale-100 active:opacity-100">
                        <div class="flex justify-between items-center pb-3 border-b border-gray-200 mb-4">
                            <h3 class="text-xl font-semibold text-gray-900">${title}</h3>
                            <button onclick="closeModal()" class="p-1 leading-none text-gray-400 hover:text-gray-600 transition duration-150">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                        ${content}
                    </div>
                </div>
            `;
            // Manually activate the transform transition
            setTimeout(() => {
                const dialog = container.querySelector('.relative');
                if(dialog) {
                    dialog.classList.remove('scale-95', 'opacity-0');
                    dialog.classList.add('scale-100', 'opacity-100');
                }
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('app-modal');
            if (modal) {
                // Animate out
                modal.querySelector('.relative').classList.add('scale-95', 'opacity-0');
                modal.querySelector('.relative').classList.remove('scale-100', 'opacity-100');
                
                // Remove from DOM after transition
                setTimeout(() => {
                    modal.classList.remove('active');
                    modal.remove();
                }, 300);
            }
        }

        // Initial Data Load on Page Load
        // loadData is called in window.onload
    </script>
</body>
</html>
